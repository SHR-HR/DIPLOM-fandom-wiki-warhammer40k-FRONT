import{c as Z,u as ee,a as ae,h as se,r as s,j as e,n as v,t as te}from"./index-C_2_JlYQ.js";import{a as H}from"./validators-DjrNj5uE.js";import{A as re,P as le}from"./AuthGate-3oPU7_jC.js";import{I as L,C as ne,a as de}from"./ContentPreview-dZ7tiAuI.js";import"./types-CB9iKTr5.js";import"./SmartImg-X6HPvToj.js";import"./imgProxy-BVyZ5yvB.js";import"./eye-Dgucr8zC.js";const ie=Z("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),l="w-full px-4 py-2 rounded-lg transition outline-none bg-white border border-gray-300 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-brass focus:border-brass dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400";function be(){const G=ee(a=>a.auth.isAuthed),U=ae(),y=se(),[n,q]=s.useState(""),[d,z]=s.useState(""),[o,D]=s.useState(""),[c,M]=s.useState(""),[r,T]=s.useState(""),[h,V]=s.useState(""),[g,W]=s.useState(""),[m,$]=s.useState(""),[x,J]=s.useState(""),[u,K]=s.useState(""),[i,b]=s.useState([]),[j,N]=s.useState(!1),[f,k]=s.useState([]),w=s.useId(),I=s.useId(),C=s.useId(),S=s.useId(),A=s.useId(),_=s.useId(),F=s.useId(),B=s.useId(),P=s.useRef(null),O=s.useCallback(a=>{b(t=>[...t,{type:a,content:a==="ul"?[]:""}])},[]),Q=s.useCallback((a,t)=>{b(E=>{const p=[...E];return p[a].content=t,p}),k([])},[]),X=s.useCallback(a=>{b(t=>t.filter((E,p)=>p!==a))},[]),R=s.useMemo(()=>{if(!n.trim()||!d.trim()||i.length===0)return!1;try{return H.parse({title:n,previewImg:d,mainInfo:{name:o||void 0,image:c||void 0,age:r?Number(r):void 0,birthday:h||void 0,gender:g||void 0,appearance:m||void 0,height:x||void 0,weight:u||void 0}}),!0}catch{return!1}},[n,d,o,c,r,h,g,m,x,u,i]),Y=async()=>{if(!R){const a=[];n.trim()||a.push("Заголовок обязателен"),d.trim()||a.push("Превью изображение обязательно"),i.length===0&&a.push("Добавьте хотя бы один блок контента"),k(a),P.current?.focus(),v.error("Заполните все обязательные поля");return}try{const a=H.parse({title:n,previewImg:d,mainInfo:{name:o||void 0,image:c||void 0,age:r?Number(r):void 0,birthday:h||void 0,gender:g||void 0,appearance:m||void 0,height:x||void 0,weight:u||void 0}});N(!0);const t=await U(te({...a,mainContent:i})).unwrap();v.success("Статья успешно создана!"),y(`/article/${t.id}`)}catch(a){v.error(a?.errors?.[0]?.message||"Ошибка создания статьи")}finally{N(!1)}};return G?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-brass mb-8",children:"Создать статью"}),f.length>0&&e.jsxs("div",{className:"mb-6 p-4 rounded-xl border-2 border-mech bg-mech/10 dark:bg-mech/20",children:[e.jsxs("div",{className:"flex items-center gap-2 text-mech font-bold mb-2",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{children:"Ошибки валидации:"})]}),e.jsx("ul",{className:"list-disc list-inside text-red-600 dark:text-red-300 text-sm space-y-1",children:f.map((a,t)=>e.jsx("li",{children:a},t))})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:`rounded-2xl border-2 border-brass p-6
            bg-white/95 text-gray-900 shadow-[0_12px_28px_rgba(0,0,0,.08)]
            dark:bg-gray-900 dark:text-gray-100`,children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-brass mb-4",children:"Основная информация"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:w,className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:"Заголовок *"}),e.jsx("input",{id:w,ref:P,name:"title",className:l,value:n,onChange:a=>q(a.target.value),placeholder:"Введите заголовок статьи"})]}),e.jsx(L,{label:"Превью изображение *",placeholder:"https://example.com/image.webp",value:d,onChange:z})]})]}),e.jsxs("section",{className:`rounded-2xl border-2 border-brass p-6
            bg-white/95 text-gray-900 shadow-[0_12px_28px_rgba(0,0,0,.08)]
            dark:bg-gray-900 dark:text-gray-100`,children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-brass mb-4",children:"Главная информация персонажа"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:I,className:"sr-only",children:"Имя"}),e.jsx("input",{id:I,name:"name",className:l,placeholder:"Имя",value:o,onChange:a=>D(a.target.value)})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(L,{placeholder:"URL изображения персонажа",value:c,onChange:M})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:C,className:"sr-only",children:"Возраст"}),e.jsx("input",{id:C,name:"age",className:l,placeholder:"Возраст",type:"number",value:r,onChange:a=>T(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:S,className:"sr-only",children:"День рождения"}),e.jsx("input",{id:S,name:"birthday",className:l,placeholder:"День рождения",value:h,onChange:a=>V(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:A,className:"sr-only",children:"Пол"}),e.jsx("input",{id:A,name:"gender",className:l,placeholder:"Пол",value:g,onChange:a=>W(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:_,className:"sr-only",children:"Внешность"}),e.jsx("input",{id:_,name:"appearance",className:l,placeholder:"Внешность",value:m,onChange:a=>$(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:F,className:"sr-only",children:"Рост"}),e.jsx("input",{id:F,name:"height",className:l,placeholder:"Рост",value:x,onChange:a=>J(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:B,className:"sr-only",children:"Вес"}),e.jsx("input",{id:B,name:"weight",className:l,placeholder:"Вес",value:u,onChange:a=>K(a.target.value)})]})]})]}),e.jsxs("section",{className:`rounded-2xl border-2 border-brass p-6
            bg-white/95 text-gray-900 shadow-[0_12px_28px_rgba(0,0,0,.08)]
            dark:bg-gray-900 dark:text-gray-100`,children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-brass mb-4",children:"Контент"}),e.jsx("div",{className:"flex gap-2 mb-4 flex-wrap",children:[["h1","H1"],["h2","H2"],["p","Параграф"],["image","Изображение"],["ul","Список"]].map(([a,t])=>e.jsxs("button",{type:"button",className:`px-3 py-2 rounded-lg transition flex items-center gap-2
                    bg-gray-100 text-gray-800 hover:bg-brass hover:text-black
                    dark:bg-gray-800 dark:text-gray-100`,onClick:()=>O(a),children:[e.jsx(le,{className:"w-4 h-4"}),t]},a))}),e.jsxs("div",{className:"space-y-4",children:[i.map((a,t)=>e.jsx(ne,{block:a,index:t,onUpdate:Q,onRemove:X},t)),i.length===0&&e.jsx("div",{className:`text-center py-12 rounded-xl border-2 border-dashed
                    border-gray-300 text-gray-600
                    dark:border-gray-700 dark:text-gray-400`,children:"Добавьте блоки контента, используя кнопки выше"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",className:"flex-1 py-3 px-6 bg-brass hover:bg-yellow-600 text-black font-bold rounded-lg transition disabled:opacity-50 relative z-10",onClick:Y,disabled:j||!R,children:j?"Создание...":"Создать статью"}),e.jsx("button",{type:"button",className:`px-6 py-3 rounded-lg transition
                bg-gray-100 hover:bg-gray-200 text-gray-800
                dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-gray-100`,onClick:()=>y("/"),children:"Отмена"})]})]}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(de,{title:n,previewImg:d,mainInfo:{name:o||void 0,image:c||void 0,age:r?Number(r):void 0,birthday:h||void 0,gender:g||void 0,appearance:m||void 0,height:x||void 0,weight:u||void 0},blocks:i})})]})]}):e.jsx(re,{})}export{be as default};
