import{e as z,a as J,h as K,u as H,r as t,g as p,j as e,v as O,n as d,w as Q,x as T}from"./index-C_2_JlYQ.js";import{A as V,P as X}from"./AuthGate-3oPU7_jC.js";import{I as Y,C as Z,a as ee}from"./ContentPreview-dZ7tiAuI.js";import"./SmartImg-X6HPvToj.js";import"./imgProxy-BVyZ5yvB.js";import"./eye-Dgucr8zC.js";const c="w-full px-4 py-2 rounded-lg transition outline-none bg-white border border-gray-300 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-brass focus:border-brass dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400";function le(){const{id:o}=z(),i=J(),M=K(),G=H(a=>a.auth.isAuthed),r=H(a=>a.articles.byId[Number(o)]),[x,w]=t.useState(""),[y,C]=t.useState(""),[u,I]=t.useState(""),[v,S]=t.useState(""),[f,A]=t.useState(""),[N,B]=t.useState(""),[k,R]=t.useState(""),[j,_]=t.useState(""),[s,h]=t.useState([]),[l,E]=t.useState(""),P=t.useRef(null);t.useEffect(()=>{o&&i(p(Number(o)))},[o,i]),t.useEffect(()=>{r?.mainInfo&&(w(r.mainInfo.name||""),C(r.mainInfo.image||""),I(String(r.mainInfo.age??"")),S(r.mainInfo.birthday||""),A(r.mainInfo.gender||""),B(r.mainInfo.appearance||""),R(r.mainInfo.height||""),_(r.mainInfo.weight||""))},[r]);const U=t.useCallback(a=>{h(n=>[...n,{type:a,content:a==="ul"?[]:""}])},[]),D=t.useCallback((a,n)=>{h(m=>{const b=[...m];return b[a].content=n,b})},[]),F=t.useCallback(a=>{h(n=>n.filter((m,b)=>b!==a))},[]),g=r?.mainContent??[],L=t.useMemo(()=>{if(s.length===0)return g;const a=Number.isFinite(Number(l))&&l!==""?Math.max(0,Number(l)):g.length,n=g.slice(0,a),m=g.slice(a);return[...n,...s,...m]},[g,s,l]),W=async()=>{try{await i(O({id:Number(o),info:{name:x||void 0,image:y||void 0,age:u?Number(u):void 0,birthday:v||void 0,gender:f||void 0,appearance:N||void 0,height:k||void 0,weight:j||void 0}})).unwrap(),d.success("Информация обновлена"),i(p(Number(o)))}catch{d.error("Ошибка обновления")}},$=async()=>{if(s.length===0){d.error("Добавьте блоки"),P.current?.focus();return}try{await i(Q({id:Number(o),blocks:s,position:l?Number(l):void 0})).unwrap(),d.success("Контент добавлен"),h([]),E(""),i(p(Number(o)))}catch{d.error("Ошибка добавления")}},q=async()=>{if(s.length===0){d.error("Добавьте блоки");return}if(confirm("Заменить весь контент?"))try{await i(T({id:Number(o),blocks:s})).unwrap(),d.success("Контент заменён"),h([]),i(p(Number(o)))}catch{d.error("Ошибка замены")}};return G?r?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-brass mb-8",children:["Редактировать: ",r.title]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:`rounded-2xl border-2 border-brass p-6
            bg-white/95 text-gray-900 shadow-[0_12px_28px_rgba(0,0,0,.08)]
            dark:bg-gray-900 dark:text-gray-100`,children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-brass mb-4",children:"Главная информация персонажа"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("input",{className:c,placeholder:"Имя",value:x,onChange:a=>w(a.target.value)}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(Y,{label:"URL изображения персонажа",placeholder:"https://…",value:y,onChange:C})}),e.jsx("input",{className:c,placeholder:"Возраст",type:"number",value:u,onChange:a=>I(a.target.value)}),e.jsx("input",{className:c,placeholder:"День рождения",value:v,onChange:a=>S(a.target.value)}),e.jsx("input",{className:c,placeholder:"Пол",value:f,onChange:a=>A(a.target.value)}),e.jsx("input",{className:c,placeholder:"Внешность",value:N,onChange:a=>B(a.target.value)}),e.jsx("input",{className:c,placeholder:"Рост",value:k,onChange:a=>R(a.target.value)}),e.jsx("input",{className:c,placeholder:"Вес",value:j,onChange:a=>_(a.target.value)})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{type:"button",className:"px-6 py-2 bg-brass hover:bg-yellow-600 text-black font-bold rounded-lg transition",onClick:W,children:"Обновить информацию"}),e.jsx("button",{type:"button",className:`px-6 py-2 rounded-lg transition
                  bg-gray-100 hover:bg-gray-200 text-gray-800
                  dark:bg-gray-800 dark:hover:bg-gray-700 dark:text-gray-100`,onClick:()=>M(`/article/${o}`),children:"Назад к статье"})]})]}),e.jsxs("section",{className:`rounded-2xl border-2 border-brass p-6
            bg-white/95 text-gray-900 shadow-[0_12px_28px_rgba(0,0,0,.08)]
            dark:bg-gray-900 dark:text-gray-100`,children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-brass mb-4",children:"Контент"}),e.jsx("div",{className:"flex gap-2 mb-4 flex-wrap",children:[["h1","H1"],["h2","H2"],["p","Параграф"],["image","Изображение"],["ul","Список"]].map(([a,n])=>e.jsxs("button",{type:"button",className:`px-3 py-2 rounded-lg transition flex items-center gap-2
                    bg-gray-100 text-gray-800 hover:bg-brass hover:text-black
                    dark:bg-gray-800 dark:text-gray-100`,onClick:()=>U(a),children:[e.jsx(X,{className:"w-4 h-4"}),n]},a))}),e.jsxs("div",{className:"space-y-4",children:[s.map((a,n)=>e.jsx(Z,{block:a,index:n,onUpdate:D,onRemove:F},n)),s.length===0&&e.jsx("div",{className:`text-center py-12 rounded-xl border-2 border-dashed
                    border-gray-300 text-gray-600
                    dark:border-gray-700 dark:text-gray-400`,children:"Добавьте блоки контента, используя кнопки выше"})]}),e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row gap-3 sm:items-center",children:[e.jsx("input",{ref:P,className:`w-40 px-4 py-2 rounded-lg transition outline-none
                  bg-white border border-gray-300 text-gray-900 placeholder-gray-400
                  focus:ring-2 focus:ring-brass focus:border-brass
                  dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400`,placeholder:"Позиция",type:"number",value:l,onChange:a=>E(a.target.value)}),e.jsx("button",{type:"button",className:"px-6 py-2 bg-brass hover:bg-yellow-600 text-black font-bold rounded-lg transition disabled:opacity-50",onClick:$,disabled:s.length===0,children:"Добавить блоки"}),e.jsx("button",{type:"button",className:"px-6 py-2 bg-mech hover:bg-red-700 text-white font-bold rounded-lg transition disabled:opacity-50",onClick:q,disabled:s.length===0,children:"Заменить весь контент"})]})]})]}),e.jsxs("div",{className:"hidden lg:block",children:[e.jsx(ee,{title:r.title,previewImg:r.previewImg||"",mainInfo:{name:x||void 0,image:y||void 0,age:u?Number(u):void 0,birthday:v||void 0,gender:f||void 0,appearance:N||void 0,height:k||void 0,weight:j||void 0},blocks:L}),s.length>0&&e.jsxs("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400",children:["В предпросмотре показано: ",s.length," блок(ов) будут вставлены на позицию"," ",l===""?g.length:Math.max(0,Number(l)),"."]})]})]})]}):e.jsx("div",{className:"p-6 text-center",children:"Загрузка…"}):e.jsx(V,{})}export{le as default};
