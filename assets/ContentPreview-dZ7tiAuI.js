import{c as v,j as e,r as y,n as m,y as E}from"./index-C_2_JlYQ.js";import{S as b}from"./SmartImg-X6HPvToj.js";import{T as C}from"./AuthGate-3oPU7_jC.js";import{p as w}from"./imgProxy-BVyZ5yvB.js";import{E as S}from"./eye-Dgucr8zC.js";const A=v("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);const M=v("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);const P=v("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),L=5*1024*1024,T=["image/png","image/jpeg","image/jpg","image/webp","image/gif"],B=/\.(png|jpe?g|webp|gif)$/i;function F(r){if(B.test(r)){const a=r.split(".").pop()?.toLowerCase();return a?a==="jpg"||a==="jpeg"?"image/jpeg":`image/${a}`:null}return null}function _(r){if(!r)return"Файл не выбран";if(r.size>L)return"Файл слишком большой (максимум 5 MB)";const a=r.type||F(r.name)||"";return a.startsWith("image/")?T.includes(a)?null:"Допустимые форматы: PNG, JPEG, WEBP, GIF":"Файл должен быть изображением"}function U(r){return new Promise((a,t)=>{const c=_(r);if(c){t(new Error(c));return}const g=new FileReader;g.onload=l=>{const o=l.target?.result;typeof o=="string"&&o.startsWith("data:")?a(o):t(new Error("Не удалось прочитать файл"))},g.onerror=()=>t(new Error("Ошибка чтения файла")),g.readAsDataURL(r)})}function R({url:r,className:a="",maxHeight:t}){return r?e.jsx("div",{className:["rounded-xl border-2 border-brass bg-gray-900/70 p-1",t?"overflow-auto":"",a].join(" "),style:t?{maxHeight:t}:void 0,children:e.jsx(b,{original:r,variant:"content",fit:"contain",framed:!0,className:"!w-full !h-auto object-contain select-none",outerClassName:"!my-0"})}):null}const W="w-full px-4 py-2 rounded-lg transition outline-none bg-white border border-gray-300 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-brass focus:border-brass dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400";function G({value:r,onChange:a,label:t,placeholder:c}){const[g,l]=y.useState(""),[o,x]=y.useState(!1),s=y.useRef(null),i=async p=>{const u=p.target.files?.[0];if(!u)return;const N=_(u);if(N){m.error(N);return}try{const f=await E(u);x(!1),l(""),a(f),m.success("Изображение загружено на сервер")}catch(f){try{const j=await U(u);l(j),x(!0),a(j),m.error("Бэкенд недоступен — показан локальный превью (не публикуется)")}catch{m.error(f?.message||"Ошибка загрузки файла")}}},d=p=>{x(!1),l(""),a(p)},n=()=>{l(""),x(!1),a(""),s.current&&(s.current.value="")},h=o?g:r;return e.jsxs("div",{className:"space-y-2",children:[t&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:W,placeholder:c||"https://example.com/image.webp",value:o?"":r,onChange:p=>d(p.target.value),disabled:o}),e.jsxs("button",{type:"button",className:`px-4 py-2 rounded-lg transition flex items-center gap-2
            bg-gray-100 text-gray-800 hover:bg-brass hover:text-black border border-brass
            dark:bg-gray-800 dark:text-gray-100`,onClick:()=>s.current?.click(),children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Файл"})]}),(o||r)&&e.jsx("button",{type:"button",className:"px-3 py-2 bg-mech hover:bg-red-700 text-white rounded-lg transition",onClick:n,children:e.jsx(P,{className:"w-5 h-5"})})]}),e.jsx("input",{ref:s,type:"file",accept:"image/*",className:"hidden",onChange:i}),h&&e.jsxs("div",{className:"relative",children:[e.jsx(R,{url:h,maxHeight:256,className:"rounded-lg"}),o&&e.jsx("div",{className:"absolute top-2 right-2 bg-brass text-black px-2 py-1 rounded text-xs font-bold",children:"ЛОКАЛЬНО"})]}),o&&e.jsx("p",{className:"text-xs text-yellow-600 dark:text-yellow-500",children:"⚠️ Сервер не принял файл — сейчас используется локальное превью (в публикацию не попадёт)."})]})}const k="w-full px-4 py-2 rounded-lg transition outline-none bg-white border border-gray-300 text-gray-900 placeholder-gray-400 focus:ring-2 focus:ring-brass focus:border-brass dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:placeholder-gray-400";function V({block:r,index:a,onUpdate:t,onRemove:c}){const[g,l]=y.useState(!1),o=()=>{switch(r.type){case"h1":return"Основной заголовок раздела";case"h2":return"Подзаголовок для структурирования контента";case"p":return"Основной текстовый блок";case"image":return"Добавить изображение (URL или файл с устройства)";case"ul":return"Список элементов (каждая строка = элемент)";default:return""}},x=()=>{switch(r.type){case"h1":return"Введите основной заголовок...";case"h2":return"Введите подзаголовок...";case"p":return"Введите текст параграфа...";case"ul":return`Элемент списка 1
Элемент списка 2
Элемент списка 3`;default:return"Введите текст..."}},s=()=>r.type==="ul"?Array.isArray(r.content)&&r.content.length>0:r.content&&String(r.content).trim().length>0,i=()=>Array.isArray(r.content)?r.content.map(n=>typeof n=="string"?n:n?.content??"").join(`
`):"",d=n=>{const h=n.split(`
`).map(p=>p.trim()).filter(Boolean).map(p=>({content:p}));t(a,h)};return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-all
        bg-white text-gray-900 border-gray-200 shadow-[0_2px_10px_rgba(0,0,0,.04)]
        dark:bg-gray-900 dark:text-gray-100 ${s()?"dark:border-gray-700":"dark:border-mech/50 border-mech/40"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-sm font-semibold px-2 py-1 rounded
              bg-gray-100 text-gray-800
              dark:bg-gray-800 dark:text-gray-200`,children:r.type.toUpperCase()}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",className:"text-gray-500 hover:text-brass transition dark:text-gray-400",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),"aria-label":"Подсказка по типу блока",children:e.jsx(A,{className:"w-4 h-4"})}),g&&e.jsx("div",{className:"tooltip -top-10 left-0 whitespace-nowrap",children:o()})]}),!s()&&e.jsx("span",{className:"text-xs text-mech",children:"Заполните поле"})]}),e.jsx("button",{type:"button",className:"text-mech hover:text-red-400 transition p-2 hover:bg-mech/10 rounded",onClick:()=>c(a),"aria-label":"Удалить блок",title:"Удалить блок",children:e.jsx(C,{className:"w-4 h-4"})})]}),r.type==="image"?e.jsx(G,{value:typeof r.content=="string"?r.content:"",onChange:n=>t(a,n),placeholder:"URL изображения или загрузите с устройства"}):r.type==="ul"?e.jsx("textarea",{className:k,placeholder:x(),rows:4,value:i(),onChange:n=>d(n.target.value)}):e.jsx("textarea",{className:k,placeholder:x(),rows:r.type==="p"?4:2,value:typeof r.content=="string"?r.content:"",onChange:n=>t(a,n.target.value)})]})}function z({title:r,previewImg:a,mainInfo:t,blocks:c}){const g=(s,i)=>{switch(s.type){case"h1":return e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight text-gray-900 dark:text-brass mb-4 drop-shadow-[0_1px_0_rgba(255,255,255,0.4)] dark:drop-shadow-[0_0_16px_rgba(212,163,58,0.35)]",children:s.content||"Пустой заголовок"},i);case"h2":return e.jsx("h2",{className:"text-2xl font-bold tracking-tight text-gray-900 dark:text-brass mb-3 drop-shadow-[0_1px_0_rgba(255,255,255,0.35)] dark:drop-shadow-[0_0_12px_rgba(212,163,58,0.35)]",children:s.content||"Пустой подзаголовок"},i);case"p":return e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4 leading-relaxed",children:s.content||"Пустой параграф"},i);case"image":{const d=String(s.content||""),n=d?w(d):"";return d?e.jsx(b,{original:d,src:n,variant:"content",fit:"contain",framed:!0,outerClassName:"my-6",className:"!w-full !h-auto object-contain select-none",alt:""},i):e.jsx("div",{className:`my-6 p-8 border-2 border-dashed rounded-xl text-center
                       border-gray-300 text-gray-500
                       dark:border-gray-700 dark:text-gray-500`,children:"Изображение не загружено"},i)}case"ul":{const d=Array.isArray(s.content)?s.content.map(n=>typeof n=="string"?n:n?.content??"").map(n=>String(n).trim()).filter(Boolean):[];return e.jsx("ul",{className:"list-disc list-inside space-y-2 mb-4 text-gray-700 dark:text-gray-300",children:d.length>0?d.map((n,h)=>e.jsx("li",{children:n},h)):e.jsx("li",{className:"text-gray-500 dark:text-gray-500",children:"Пустой список"})},i)}default:return null}},l=w(a),o=[["Name",t?.name],["Age",t?.age],["Birthday",t?.birthday],["Gender",t?.gender],["Appearance",t?.appearance],["Height",t?.height],["Weight",t?.weight]],x=!!t&&(!!t.image||o.some(([,s])=>s!=null&&s!==""));return e.jsxs("div",{className:"sticky top-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-brass mb-4",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("h3",{className:"text-xl font-bold",children:"Предпросмотр"})]}),e.jsxs("div",{className:`
          rounded-2xl border-2 border-brass
          bg-white/95 shadow-[0_0_0_1px_rgba(212,163,58,0.25),0_25px_60px_-10px_rgba(0,0,0,0.15)]
          dark:bg-gradient-to-br dark:from-gray-900 dark:to-black
          p-6 max-h-[calc(100vh-8rem)] overflow-y-auto overflow-x-hidden
          wh-preview
        `,children:[r?e.jsx("h1",{className:"text-3xl font-extrabold tracking-tight text-gray-900 dark:text-brass mb-4 drop-shadow-[0_1px_0_rgba(255,255,255,0.4)] dark:drop-shadow-[0_0_16px_rgba(212,163,58,0.35)]",children:r}):e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-800 rounded animate-pulse mb-4"}),a?e.jsx(b,{original:a,src:l,variant:"hero",fit:"cover",framed:!0,radiusClass:"rounded-xl",className:"!rounded-none",alt:""}):e.jsx("div",{className:"h-48 bg-gray-100 dark:bg-gray-800 rounded-xl mb-6 flex items-center justify-center text-gray-400 dark:text-gray-600",children:"Превью изображение"}),x&&e.jsxs("section",{className:`
              group rounded-2xl border-2 border-brass overflow-hidden mb-6
              bg-white/90 text-gray-800
              dark:bg-gray-900 dark:text-gray-200
            `,children:[e.jsx("div",{className:"px-4 pt-4 pb-3 border-b border-gray-100 dark:border-gray-800",children:e.jsx("h3",{className:"text-xl font-extrabold tracking-wide text-gray-900 dark:text-brass",children:"Главная информация"})}),e.jsxs("div",{className:"p-4 space-y-4",children:[t?.image?e.jsx(b,{original:t.image,src:w(t.image),variant:"content",fit:"contain",framed:!0,alt:""}):null,e.jsx("div",{className:"space-y-2",children:o.filter(([,s])=>!!s).map(([s,i])=>e.jsxs("div",{className:`
                        flex items-baseline gap-3
                        rounded-xl
                        ring-1 ring-black/5 bg-white/70
                        px-3.5 py-2.5
                        transition
                        hover:bg-white/85
                        dark:ring-0 dark:bg-transparent dark:border-b dark:border-gray-800
                      `,children:[e.jsxs("span",{className:`
                          shrink-0 uppercase tracking-widest font-bold
                          text-[0.78rem] text-gray-500
                          dark:text-gray-400
                        `,style:{letterSpacing:".06em"},children:[s,":"]}),e.jsx("span",{className:"text-gray-900 dark:text-gray-200",children:String(i)})]},s))})]})]}),e.jsx("div",{className:"prose max-w-none dark:prose-invert",children:c.length>0?c.map(g):e.jsx("div",{className:"text-center py-12 text-gray-400 dark:text-gray-600",children:"Добавьте блоки контента"})})]})]})}export{V as C,G as I,z as a};
