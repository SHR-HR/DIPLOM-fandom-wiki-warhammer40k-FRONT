import{c as y,u as b,a as F,h as H,i as O,k as V,r as t,n as o,l as $,m as E,R as P,j as e,U as q,L as f,o as G,p as K,q as Y}from"./index-BOMAx2s1.js";import{A as B,P as J,T as Q}from"./AuthGate-BJTqAmKS.js";import{p as W}from"./validators-DjrNj5uE.js";import{S as I}from"./SmartImg-BZFKFhOS.js";import"./types-CB9iKTr5.js";import"./imgProxy-B4gxZNSk.js";const X=y("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const M=y("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const Z=y("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function le(){const u=b(s=>s.auth.isAuthed),v=b(s=>s.auth.mode),{profile:a,my:n}=b(s=>s.profile),l=F(),i=H(),D=O(),[d,j]=V(),h=D.state?.from?.pathname,[m,p]=t.useState(!1),[g,N]=t.useState(""),[c,w]=t.useState(""),[k,S]=t.useState(null),[A,C]=t.useState(null),x=t.useMemo(()=>{if(!a)return null;const s=a.createdAt||a.created_at||a.created||null;if(!s)return null;try{const r=new Date(s);return Number.isNaN(r.getTime())?String(s):r.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}catch{return String(s)}},[a]);t.useEffect(()=>{d.get("expired")==="1"&&(o("Ð¡ÐµÐ°Ð½Ñ Ð¸ÑÑ‚Ñ‘Ðº, Ð²Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°.",{icon:"ðŸ”’"}),d.delete("expired"),j(d,{replace:!0}))},[d,j]),t.useEffect(()=>{if(!u)return;if(v!=="local"&&(l($()),l(E())),h){i(h,{replace:!0});return}const s=sessionStorage.getItem(P);s&&(sessionStorage.removeItem(P),i(s,{replace:!0}))},[u,v,l,i,h]),t.useEffect(()=>{a&&(N(a.name),w(a.ava||""))},[a]);const L=t.useMemo(()=>m?c:a?.ava||"",[m,c,a?.ava]),U=async()=>{try{S(null),W.parse({name:g,ava:c}),await l(G({name:g,ava:c})).unwrap(),o.success("ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»Ñ‘Ð½"),p(!1)}catch(s){const r=s?.errors?.[0]?.message||s?.message||"ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ";S(String(r)),o.error(String(r))}},R=async s=>{if(confirm("Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑŒÑŽ?"))try{C(s),await K(s),o.success("Ð¡Ñ‚Ð°Ñ‚ÑŒÑ ÑƒÐ´Ð°Ð»ÐµÐ½Ð°"),l(E())}catch{o.error("ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ")}finally{C(null)}},T=async()=>{await l(Y()),o.success("Ð’Ñ‹ Ð²Ñ‹ÑˆÐ»Ð¸ Ð¸Ð· ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹"),i("/",{replace:!0})};return u?e.jsxs("div",{className:"container mx-auto px-3 sm:px-4 md:px-6 py-4 sm:py-6 md:py-8 space-y-6 sm:space-y-8 min-h-[calc(100vh-16rem)]",children:[e.jsxs("section",{className:"max-w-2xl mx-auto rounded-xl sm:rounded-2xl border-2 border-brass bg-gray-900 p-4 sm:p-6 md:p-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(q,{className:"w-8 h-8 text-brass"}),e.jsx("h1",{className:"text-3xl font-bold text-brass",children:"ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ"})]}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx(I,{original:L,alt:a.name,variant:"content",fit:"cover",framed:!0,radiusClass:"rounded-full",className:"w-full h-full object-cover",lazy:!0,outerClassName:"w-32 h-32 sm:w-40 sm:h-40 border-2 border-brass my-0"},L),e.jsx("div",{className:"flex-1",children:m?e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{className:"w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:ring-2 focus:ring-brass outline-none",placeholder:"Ð˜Ð¼Ñ",value:g,onChange:s=>N(s.target.value)}),e.jsxs("div",{children:[e.jsx("input",{className:"w-full px-3 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:ring-2 focus:ring-brass outline-none",placeholder:"URL Ð°Ð²Ð°Ñ‚Ð°Ñ€Ð°",value:c,onChange:s=>w(s.target.value)}),k&&e.jsx("p",{className:"text-sm text-mech mt-1",children:k})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-1",children:a.name}),(x||n.length>0)&&e.jsxs("p",{className:"text-xs text-gray-400 mb-2",children:[x&&e.jsxs(e.Fragment,{children:["ÐÐ° ÑÐ°Ð¹Ñ‚Ðµ Ñ ",x]}),x&&n.length>0&&" Â· ",n.length>0&&e.jsxs(e.Fragment,{children:["Ð¡Ñ‚Ð°Ñ‚ÐµÐ¹: ",n.length]})]}),a.ava&&e.jsx("p",{className:"text-gray-500 text-xs break-all",children:a.ava})]})})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[m?e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-brass hover:bg-yellow-600 text-black font-bold rounded-lg transition",onClick:U,children:[e.jsx(Z,{className:"w-4 h-4"}),"Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"]}),e.jsx("button",{className:"px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition",onClick:()=>p(!1),children:"ÐžÑ‚Ð¼ÐµÐ½Ð°"})]}):e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-gray-800 hover:bg-brass hover:text-black border border-brass rounded-lg transition",onClick:()=>p(!0),children:[e.jsx(M,{className:"w-4 h-4"}),"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"]}),e.jsxs(f,{to:"/new",className:"ml-auto flex items-center gap-2 px-4 py-2 rounded-lg border-2 border-brass bg-gray-900 hover:bg-brass hover:text-black transition",children:[e.jsx(J,{className:"w-4 h-4"}),"ÐÐ¾Ð²Ð°Ñ ÑÑ‚Ð°Ñ‚ÑŒÑ"]}),e.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-mech hover:bg-red-700 text-white rounded-lg transition",onClick:T,children:[e.jsx(X,{className:"w-4 h-4"}),"Ð’Ñ‹Ð¹Ñ‚Ð¸"]})]})]})]}),e.jsxs("section",{className:"max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-brass mb-4",children:"ÐœÐ¾Ð¸ ÑÑ‚Ð°Ñ‚ÑŒÐ¸"}),n.length===0?e.jsx("p",{className:"text-center text-gray-400 py-10",children:"Ð£ Ð²Ð°Ñ Ð¿Ð¾ÐºÐ° Ð½ÐµÑ‚ ÑÑ‚Ð°Ñ‚ÐµÐ¹"}):e.jsx("div",{className:"space-y-4",children:n.map(s=>{const r=s.isDraft??s.draft??s.status==="draft",_=r?"Ð§ÐµÑ€Ð½Ð¾Ð²Ð¸Ðº":"ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ð½Ð¾",z="inline-flex items-center px-2.5 py-0.5 rounded-full text-[11px] font-semibold uppercase tracking-wide border shadow-sm "+(r?"border-gray-500/80 bg-gray-900/80 text-gray-200":"border-brass/80 bg-brass text-black");return e.jsxs("div",{className:"group flex items-center gap-4 p-4 rounded-2xl border border-brass bg-gray-900/95 hover:bg-gray-900 hover:-translate-y-[2px] hover:shadow-[0_0_26px_rgba(180,141,87,0.55)] transition-all duration-200",children:[e.jsx(I,{original:s.previewImg,alt:s.title,variant:"content",fit:"cover",framed:!0,className:"w-full h-full object-cover group-hover:scale-[1.03] transition-transform duration-200",lazy:!0,outerClassName:"w-32 h-24 sm:w-40 sm:h-28 rounded-xl my-0"},s.previewImg),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{to:`/article/${s.id}`,className:"text-lg font-bold text-brass hover:text-yellow-400 line-clamp-2",title:s.title,children:s.title}),e.jsx("span",{className:z,children:_})]})}),e.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[e.jsx(f,{to:`/edit/${s.id}`,title:"Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",className:"icon-btn",children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>R(s.id),title:"Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ",className:"icon-btn icon-btn--danger disabled:opacity-50",disabled:A===s.id,children:A===s.id?e.jsx("span",{className:"inline-block w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(Q,{className:"w-4 h-4"})})]})]},s.id)})})]})]}):e.jsx(B,{})}export{le as default};
