import { configureStore } from "@reduxjs/toolkit";

// ИМПОРТ СЛАЙСОВ ПРИЛОЖЕНИЯ WARHAMMER 40,000 FANDOM WIKI

// Слайсы приложения
import auth from "@/features/auth/authSlice";        // Управление аутентификацией и пользовательскими сессиями
import articles from "@/features/articles/articlesSlice"; // Управление статьями: список, детали, пагинация
import editor from "@/features/editor/editorSlice";  // Управление состоянием редактора статей
import profile from "@/features/profile/profileSlice"; // Управление профилем пользователя и его статьями
import ui from "@/features/ui/uiSlice";              // Управление состоянием UI: темы, поиск, сортировка, пагинация

/**
 * КОНФИГУРАЦИЯ ЦЕНТРАЛИЗОВАННОГО ХРАНИЛИЩА СОСТОЯНИЯ REDUX
 * 
 * Создает и настраивает главное хранилище состояния приложения с помощью Redux Toolkit.
 * Объединяет все слайсы в единое дерево состояния и настраивает middleware для разработки.
 * 
 * Особенности конфигурации:
 * - Отключена проверка сериализуемости для совместимости с AxiosError и другими несериализуемыми объектами
 * - DevTools включены только в режиме разработки для отладки состояния
 */
export const store = configureStore({
  /**
   * КОРНЕВОЙ РЕДУСЕР ПРИЛОЖЕНИЯ
   * 
   * Объединяет все слайсы в единую структуру состояния:
   * - auth: управление аутентификацией, пользовательскими данными и сессиями
   * - articles: управление статьями, включая списки, детали и метаданные
   * - editor: состояние редактора статей, операции создания и редактирования
   * - profile: профиль пользователя, его статьи и настройки аккаунта
   * - ui: пользовательский интерфейс, темы, поиск, сортировка и пагинация
   */
  reducer: { auth, articles, editor, profile, ui },
  
  /**
   * НАСТРОЙКА MIDDLEWARE ДЛЯ REDUX STORE
   * 
   * Кастомизирует стандартный middleware stack Redux Toolkit:
   * - serializableCheck: false - отключает проверку сериализуемости действий и состояния
   *   Это необходимо для работы с несериализуемыми объектами (AxiosError, File и т.д.)
   * - Сохраняет все остальные полезные middleware из getDefaultMiddleware()
   */
  middleware: (getDefault) =>
    getDefault({
      serializableCheck: false, // Отключение для совместимости с AxiosError и другими сложными объектами
    }),
  
  /**
   * НАСТРОЙКА REDUX DEVTOOLS ДЛЯ ОТЛАДКИ
   * 
   * Включает интеграцию с Redux DevTools только в режиме разработки:
   * - import.meta.env.DEV: true в режиме разработки, false в продакшене
   * - Позволяет инспектировать состояние и действия в браузерных DevTools
   */
  devTools: import.meta.env.DEV,
});

/**
 * ТИПЫ ДЛЯ ТИПОБЕЗОПАСНОЙ РАБОТЫ С REDUX STORE
 * 
 * Создает TypeScript типы на основе сконфигурированного store:
 * - RootState: тип всего дерева состояния приложения
 * - AppDispatch: тип функции dispatch с учетом middleware
 */

// Типы стора/диспатча

/**
 * RootState - ТИП ВСЕГО ДЕРЕВА СОСТОЯНИЯ ПРИЛОЖЕНИЯ
 * 
 * Автоматически выводится из типа store.getState()
 * Используется в типизированных хуках (useAppSelector) для доступа к состоянию
 */
export type RootState = ReturnType<typeof store.getState>;

/**
 * AppDispatch - ТИПИЗИРОВАННАЯ ФУНКЦИЯ DISPATCH
 * 
 * Автоматически выводится из типа store.dispatch
 * Используется в типизированных хуках (useAppDispatch) для отправки действий
 */
export type AppDispatch = typeof store.dispatch;




// Комментарии объясняют:

// 1. Архитектуру централизованного состояния

// Объединение всех слайсов в единое дерево состояния
// Разделение ответственности между различными функциональными модулями
// Структуру состояния всего приложения Warhammer 40,000 Fandom Wiki

// 2. Конфигурацию Redux Store

// Настройку middleware для обработки несериализуемых данных
// Интеграцию с DevTools для отладки в режиме разработки
// Оптимизацию для продакшена через условное включение DevTools

// 3. Систему типов TypeScript

// Автоматическое выведение типов из сконфигурированного store
// Типобезопасный доступ к состоянию через RootState
// Типобезопасную отправку действий через AppDispatch

// 4. Особенности реализации для проекта

// Обработку сложных объектов через отключение serializableCheck
// Интеграцию с Vite через import.meta.env.DEV
// Подготовку для масштабирования при добавлении новых слайсов

// 5. Соответствие требованиям дипломного проекта

// Баланс между функциональностью и производительностью
// Поддержку отладки без влияния на продакшен
// Соблюдение лучших практик Redux Toolkit

// Этот файл store.ts является центральным узлом управления состоянием 
// всего приложения Warhammer 40,000 Fandom Wiki, обеспечивая предсказуемое 
// и типизированное управление данными across всех компонентов и функций системы.



