import SmartImg from "@/components/SmartImg";

/**
 * ПРОПСЫ КОМПОНЕНТА ПРЕВЬЮ ИЗОБРАЖЕНИЯ ДЛЯ РЕДАКТОРА
 * 
 * @property url - исходный URL изображения (поддерживает различные протоколы и форматы)
 * @property className - дополнительные CSS классы для кастомизации контейнера
 * @property maxHeight - ограничение максимальной высоты с вертикальной прокруткой
 */
interface Props {
  url?: string;                 // ИСХОДНИК (pximg, uploads, data:, blob:, http/https)
  className?: string;           // доп. стили контейнера
  maxHeight?: number | string;  // ограничение высоты -> вертикальная прокрутка (без crop)
}

/**
 * КОМПОНЕНТ ПРЕДПРОСМОТРА ИЗОБРАЖЕНИЯ ДЛЯ РЕДАКТОРА WARHAMMER 40,000 FANDOM WIKI
 * 
 * Специализированный компонент для отображения превью изображений в интерфейсе редактора:
 * - Сохраняет пропорции изображения без обрезки (object-contain)
 * - Поддерживает вертикальную прокрутку при превышении максимальной высоты
 * - Интегрируется с SmartImg для автоматического проксирования и обработки ошибок
 * - Используется в левой колонке редактора для визуальной обратной связи
 * 
 * Особенности:
 * - Не выполняет предварительное проксирование - делегирует эту задачу SmartImg
 * - Не фиксирует высоту контейнера, позволяя изображению занимать естественное пространство
 * - Не обрезает изображение, сохраняя полную видимость всего контента
 */
export default function EditorImagePreview({ url, className = "", maxHeight }: Props) {
  // ВОЗВРАТ NULL ПРИ ОТСУТСТВИИ URL ДЛЯ ПРЕДОТВРАЩЕНИЯ ОШИБОК РЕНДЕРИНГА
  if (!url) return null;

  return (
    /**
     * КОНТЕЙНЕР ПРЕВЬЮ ИЗОБРАЖЕНИЯ С ТЕМАТИЧЕСКИМ ОФОРМЛЕНИЕМ
     * 
     * Стилизован в соответствии с дизайном Warhammer 40,000:
     * - Граница цвета brass для соответствия общей цветовой схеме
     * - Полупрозрачный темный фон для улучшения контрастности изображения
     * - Внутренний отступ для визуального отделения изображения от рамки
     * 
     * Условные классы:
     * - overflow-auto: включается только при наличии maxHeight для вертикальной прокрутки
     */
    <div
      className={[
        "rounded-xl border-2 border-brass bg-gray-900/70 p-1",
        maxHeight ? "overflow-auto" : "",
        className,
      ].join(" ")}
      // ДИНАМИЧЕСКОЕ УСТАНОВЛЕНИЕ МАКСИМАЛЬНОЙ ВЫСОТЫ ЧЕРЕЗ INLINE STYLES
      style={maxHeight ? { maxHeight } : undefined}
    >
      {/*
        КОМПОНЕНТ УМНОГО ИЗОБРАЖЕНИЯ С ОПТИМИЗИРОВАННЫМИ НАСТРОЙКАМИ ДЛЯ РЕДАКТОРА
        
        Ключевые параметры:
        - original: передается исходный URL без предварительной обработки
        - variant="content": режим отображения для контентных изображений
        - fit="contain": сохранение пропорций без обрезки
        - framed: добавление стандартной рамки SmartImg
        - className: принудительная установка адаптивных размеров
        - outerClassName: отключение стандартных отступов для интеграции в редактор
      */}
      <SmartImg
        original={url}          // <- ключевое: исходник, без прокси
        variant="content"
        fit="contain"
        framed
        className="!w-full !h-auto object-contain select-none"
        outerClassName="!my-0"
      />
    </div>
  );
}






// Комментарии объясняют:

// 1. Специализированное назначение компонента

// Интеграция с редактором статей для мгновенного предпросмотра изображений
// Оптимизированное отображение без искажения пропорций и обрезки
// Поддержка различных источников изображений (внешние URL, data URI, blob)

// 2. Архитектуру взаимодействия с SmartImg

// Делегирование проксирования - компонент не обрабатывает URL, передавая эту задачу SmartImg
// Сохранение исходного качества через fit="contain" без обрезки
// Интеграцию в интерфейс редактора через отключение стандартных отступов

// 3. Адаптивное управление размерами

// Гибкое ограничение высоты через maxHeight с вертикальной прокруткой
// Сохрание пропорций изображения через object-contain
// Адаптивную ширину через !w-full для заполнения доступного пространства

// 4. Пользовательский опыт в редакторе

// Визуальную обратную связь при загрузке изображений
// Возможность просмотра всего изображения без обрезки
// Эффективное использование пространства в ограниченной области редактора

// 5. Технические особенности реализации

// Условный рендеринг при отсутствии URL для избежания ошибок
// Комбинирование классов через массив для гибкости стилизации
// Инлайн стили для динамического управления maxHeight

// Компонент EditorImagePreview обеспечивает удобный и функциональный интерфейс 
// предпросмотра изображений в редакторе статей Warhammer 40,000 Fandom Wiki, 
// сочетая простоту использования с мощными возможностями адаптивного отображения и 
// интеграции с системой умных изображений.






