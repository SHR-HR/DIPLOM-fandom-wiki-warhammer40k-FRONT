/**
 * МОДЕЛИ ДАННЫХ API WARHAMMER 40,000 FANDOM WIKI
 * 
 * Этот файл содержит TypeScript интерфейсы и типы для взаимодействия с бэкенд API.
 * Все типы соответствуют структуре данных, ожидаемой от серверного API.
 */

/** ===== Типы домена API ===== */

/**
 * РЕЖИМ АУТЕНТИФИКАЦИИ ПРИЛОЖЕНИЯ
 * 
 * Определяет способ авторизации пользователей в системе:
 * - "local" - локальная разработка без реальной аутентификации
 * - "basic" - базовая HTTP аутентификация
 * - "hybrid" - гибридный режим с несколькими провайдерами
 */
export type AuthMode = "local" | "basic" | "hybrid";

/**
 * ОСНОВНАЯ ИНФОРМАЦИЯ О ПЕРСОНАЖЕ В СТАТЬЕ
 * 
 * Содержит ключевые характеристики персонажа вселенной Warhammer 40,000:
 * - Биометрические данные (возраст, пол, внешность)
 * - Физические параметры (рост, вес)
 * - Дополнительные характеристики в свободной форме
 */
export interface ApiMainInfo {
  name?: string;                    // Имя персонажа
  image?: string;                   // URL изображения (поддерживает различные форматы: http/https, /uploads, data:, blob:)
  age?: number;                     // Возраст персонажа
  birthday?: string;                // Дата рождения
  gender?: string;                  // Пол
  appearance?: string;              // Описание внешности
  height?: string;                  // Рост
  weight?: string;                  // Вес
  other?: Record<string, unknown>;  // Дополнительные характеристики
}

/**
 * ДОПУСТИМЫЕ ТИПЫ КОНТЕНТ-БЛОКОВ ПО ТЕХНИЧЕСКОМУ ЗАДАНИЮ
 * 
 * Определяет структурные элементы содержимого статей:
 * - h1, h2 - заголовки различных уровней
 * - p - текстовые абзацы
 * - image - изображения
 * - ul - маркированные списки
 */
export type ApiBlockType = "h1" | "h2" | "p" | "image" | "ul";

/**
 * ЭЛЕМЕНТ СПИСКА СТАТЬИ
 * 
 * Поддерживает гибкий формат элементов списка для совместимости:
 * - Простая строка
 * - Объект с полем content для сложных структур
 */
export type ApiListItem = string | { content?: string; [k: string]: unknown };

/**
 * СТРОГО ТИПИЗИРОВАННЫЕ ИЗВЕСТНЫЕ БЛОКИ КОНТЕНТА
 * 
 * Предоставляет точные TypeScript типы для IDE и проверки типов:
 * - Каждый тип блока имеет соответствующую структуру содержимого
 * - Обеспечивает автодополнение и проверку на этапе разработки
 */
export type KnownContentBlock =
  | { type: "h1"; content: string }                           // Заголовок первого уровня
  | { type: "h2"; content: string }                           // Заголовок второго уровня
  | { type: "p"; content: string }                            // Текстовый абзац
  | { type: "image"; content: string | { src: string } }      // Изображение (URL или объект с src)
  | { type: "ul"; content: ApiListItem[] };                   // Маркированный список

/**
 * УНИВЕРСАЛЬНЫЙ ИНТЕРФЕЙС БЛОКА КОНТЕНТА
 * 
 * Обеспечивает обратную совместимость с неизвестными типами блоков:
 * - type: string - допускает любые значения для гибкости
 * - content: any - универсальное содержимое
 * Конкретные типы описаны в KnownContentBlock для строгой типизации
 */
export interface ApiContentBlock {
  type: string;           // Тип блока (допускает любые значения для обратной совместимости)
  content: any;           // Содержимое блока (конкретные формы описаны в KnownContentBlock)
}

/**
 * ПАРАМЕТРЫ ПАГИНАЦИИ И ФИЛЬТРАЦИИ ДЛЯ ЗАПРОСОВ СПИСКОВ
 * 
 * Используется для постраничной навигации и поиска по статьям:
 * - start - смещение (offset) для пагинации
 * - limit - размер страницы
 * - q - поисковый запрос
 * - sort - поле для сортировки
 * - dir - направление сортировки
 */
export interface ApiListParams {
  start?: number;         // Смещение (аналог offset)
  limit?: number;         // Размер страницы
  q?: string;             // Поисковый запрос
  sort?: "id" | "title" | "author";  // Поле сортировки
  dir?: "asc" | "desc";   // Направление сортировки
}

/**
 * КОРОТКАЯ КАРТОЧКА СТАТЬИ ДЛЯ СПИСКОВ И ПРЕВЬЮ
 * 
 * Содержит минимальный набор информации для отображения в списках:
 * - Основные идентификаторы и заголовок
 * - URL превью-изображения
 * - Имя автора
 */
export interface ApiArticleShort {
  id: number;             // Уникальный идентификатор статьи
  title: string;          // Заголовок статьи
  previewImg?: string;    // URL изображения для превью
  author?: string;        // Имя автора статьи
}

/**
 * СТРУКТУРА ОТВЕТА API ДЛЯ СПИСКОВЫХ ЗАПРОСОВ
 * 
 * Стандартизированный формат ответа для пагинированных данных:
 * - items - массив элементов текущей страницы
 * - total - общее количество элементов (для пагинации)
 */
export interface ApiListResponse<TItem> {
  items: TItem[];         // Массив элементов на текущей странице
  total: number;          // Общее количество элементов (для расчета пагинации)
}

/**
 * ДАННЫЕ ДЛЯ СОЗДАНИЯ НОВОЙ СТАТЬИ
 * 
 * Соответствует требованиям технического задания:
 * - Обязательные поля: title и previewImg
 * - Опциональные блоки основной информации и контента
 */
export interface ApiArticleCreate {
  title: string;                      // Обязательный заголовок статьи
  previewImg: string;                 // Обязательное превью-изображение (по ТЗ)
  mainInfo?: ApiMainInfo;             // Основная информация о персонаже
  mainContent?: ApiContentBlock[];    // Блоки содержимого статьи
}

/**
 * ПОЛНАЯ МОДЕЛЬ СТАТЬИ С ИДЕНТИФИКАТОРАМИ
 * 
 * Расширяет модель создания статьи серверными полями:
 * - id - уникальный идентификатор
 * - author - имя автора
 * - author_id - идентификатор автора
 */
export interface ApiArticle extends ApiArticleCreate {
  id: number;             // Уникальный идентификатор статьи
  author?: string;        // Имя автора (для отображения)
  author_id?: number;     // Идентификатор автора (для проверок прав)
}

/**
 * ПРОФИЛЬ ПОЛЬЗОВАТЕЛЯ СИСТЕМЫ
 * 
 * Содержит информацию о пользователе и его активности:
 * - Основные данные профиля
 * - Статистика по статьям
 * - Поля для обратной совместимости (user_id)
 */
export interface ApiUserProfile {
  id: number;                     // Уникальный идентификатор профиля
  name: string;                   // Отображаемое имя пользователя
  authored?: number;              // Количество созданных статей
  totalArticles?: number;         // Общее количество статей (альтернативное поле)
  ava?: string;                   // URL аватара пользователя
  user_id?: number;               // Совместимость со старым форматом (альтернативный ID)
}

/**
 * ДАННЫЕ ДЛЯ ОБНОВЛЕНИЯ ПРОФИЛЯ ПОЛЬЗОВАТЕЛЯ
 * 
 * Все поля опциональны - можно обновлять только измененные данные
 */
export interface ApiUserUpdate {
  name?: string;          // Новое имя пользователя
  ava?: string;           // Новый URL аватара
}

/**
 * ДАННЫЕ РЕГИСТРАЦИИ НОВОГО ПОЛЬЗОВАТЕЛЯ
 * 
 * Используется при создании новой учетной записи:
 * - Обязательные: имя, логин и пароль
 * - Опциональный email
 */
export interface ApiRegisterUser {
  name: string;           // Отображаемое имя пользователя
  login: string;          // Уникальный логин для входа
  password: string;       // Пароль учетной записи
  email?: string;         // Опциональный email пользователя
}

/**
 * ДАННЫЕ ДЛЯ АУТЕНТИФИКАЦИИ ПОЛЬЗОВАТЕЛЯ
 * 
 * Используется в Redux thunk для процесса входа:
 * - username - логин пользователя
 * - password - пароль (опционально в некоторых режимах)
 * - remember - флаг сохранения сессии
 */
export interface ApiLoginRequest {
  username: string;       // Логин пользователя
  password?: string;      // Пароль (опционально для некоторых режимов аутентификации)
  remember?: boolean;     // Запомнить пользователя (долгая сессия)
}




// Комментарии объясняют:

// 1. Назначение файла

// Централизованное хранение TypeScript типов для API
// Обеспечение типобезопасности во всем фронтенд приложении
// Соответствие структуре данных бэкенд API

// 2. Бизнес-логику предметной области

// Модели данных для вселенной Warhammer 40,000
// Структуру статей о персонажах и фракциях
// Систему пользователей и авторизации

// 3. Технические особенности

// Гибкие типы для обратной совместимости
// Строгая типизация для разработки в IDE
// Поддержка различных форматов данных (URL, изображения)

// 4. Архитектурные решения

// Разделение на короткие и полные модели для оптимизации
// Пагинация и фильтрация данных
// Система аутентификации с различными режимами

// 5. Соответствие требованиям

// Выполнение технического задания (previewImg в статьях)
// Совместимость с существующим бэкенд API
// Поддержка различных сценариев использования

// Файл обеспечивает надежную основу для типобезопасной разработки фронтенд приложения
// Warhammer 40,000 Fandom Wiki, значительно снижая вероятность ошибок времени
// выполнения за счет строгой проверки типов на этапе компиляции.


