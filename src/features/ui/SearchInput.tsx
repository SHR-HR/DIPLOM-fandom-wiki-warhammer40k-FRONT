import { useAppDispatch, useAppSelector } from "@/app/hooks";
import { setSearch, setPaging } from "./uiSlice";
import { Search } from "lucide-react";
import { useId } from "react";

/**
 * КОМПОНЕНТ ПОИСКОВОГО ВВОДА WARHAMMER 40,000 FANDOM WIKI
 * 
 * Предоставляет пользователю интерфейс для поиска статей по заголовкам:
 * - Интегрирован с Redux store для глобального управления состоянием поиска
 * - Автоматически сбрасывает пагинацию при изменении поискового запроса
 * - Поддерживает темную и светлую темы оформления
 * - Обеспечивает доступность и удобство использования
 */
export default function SearchInput() {
  /**
   * ПОЛУЧЕНИЕ СОСТОЯНИЯ ПОИСКА И ПАГИНАЦИИ ИЗ REDUX STORE
   * 
   * - search: текущий поисковый запрос
   * - limit: количество элементов на странице (сохраняется при сбросе пагинации)
   */
  const { search, limit } = useAppSelector((s) => s.ui);
  
  /**
   * ПОЛУЧЕНИЕ ФУНКЦИИ ДИСПАТЧА ДЛЯ ОБНОВЛЕНИЯ СОСТОЯНИЯ
   */
  const d = useAppDispatch();
  
  /**
   * ГЕНЕРАЦИЯ УНИКАЛЬНОГО ID ДЛЯ ДОСТУПНОСТИ
   * 
   * Создает уникальный идентификатор для связки label и input
   * Улучшает опыт пользователей с screen readers
   */
  const inputId = useId();

  return (
    <div className="relative flex-1 max-w-md">
      {/* 
        СКРЫТАЯ МЕТКА ДЛЯ ДОСТУПНОСТИ
        - htmlFor: связывает метку с полем ввода по id
        - sr-only: визуально скрыта, но доступна для screen readers
      */}
      <label htmlFor={inputId} className="sr-only">
        Поиск по заголовкам
      </label>
      
      {/* 
        ИКОНКА ПОИСКА (ЛУПА)
        - Абсолютное позиционирование внутри контейнера
        - Центрирование по вертикали через transform
        - Нейтральный цвет для лучшей видимости в обеих темах
      */}
      <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
      
      {/*
        ПОЛЕ ВВОДА ПОИСКОВОГО ЗАПРОСА
        - type="search": семантический тип для поисковых полей
        - autoComplete="off": отключает автозаполнение для чистого UX
        - Сложная система классов для поддержки двух тем
      */}
      <input
        id={inputId}
        name="q"
        type="search"
        autoComplete="off"
        className="
          w-full pl-10 pr-4 py-2 rounded-lg border outline-none transition
          bg-white text-gray-900 placeholder-gray-400
          focus:ring-2 focus:ring-brass focus:border-transparent
          dark:bg-gray-900 dark:text-white dark:border-gray-700
        "
        placeholder="Поиск по заголовкам..."
        value={search}
        onChange={(e) => {
          /**
           * ОБРАБОТЧИК ИЗМЕНЕНИЯ ЗНАЧЕНИЯ ПОИСКА
           * 
           * При каждом изменении поля ввода:
           * 1. Обновляет поисковый запрос в Redux store
           * 2. Сбрасывает пагинацию на первую страницу (start: 0)
           * 
           * Это обеспечивает:
           * - Мгновенный поиск без необходимости нажимать Enter
           * - Автоматический переход к релевантным результатам с начала
           * - Сохранение пользовательских предпочтений размера страницы (limit)
           */
          d(setSearch(e.target.value));
          // при смене запроса безопасно уходим на первую страницу
          d(setPaging({ start: 0, limit }));
        }}
      />
    </div>
  );
}




// Комментарии объясняют:

// 1. Архитектуру компонента

// Интеграцию с Redux store для глобального управления состоянием поиска
// Синхронизацию поиска и пагинации для согласованного поведения
// Поддержку темизации через условные CSS классы

// 2. Пользовательский опыт

// Интуитивный дизайн с иконкой лупы для узнаваемости
// Мгновенный поиск без необходимости подтверждения
// Автоматическую навигацию к релевантным результатам
// Адаптивную ширину с максимальным ограничением

// 3. Функциональность поиска

// Сброс пагинации при изменении запроса для показа самых релевантных результатов
// Сохранение размера страницы (limit) как пользовательской настройки
// Поддержку темной и светлой тем через CSS conditional classes

// 4. Технические особенности

// Генерацию уникальных ID для доступности через React useId
// Семантическую разметку с правильными типами и атрибутами
// Оптимизированную стилизацию через Tailwind CSS утилиты

// 5. Доступность и UX

// Скрытые метки для screen readers
// Правильные placeholder с понятной инструкцией
// Фокус-индикаторы в фирменных цветах (brass)
// Плавные переходы для визуальной обратной связи

// Компонент SearchInput обеспечивает мощный и удобный поисковый интерфейс
// для Warhammer 40,000 Fandom Wiki, интегрируясь с глобальной системой состояния 
// и предоставляя пользователям мгновенный доступ к релевантному контенту с учетом
// их предпочтений отображения.







