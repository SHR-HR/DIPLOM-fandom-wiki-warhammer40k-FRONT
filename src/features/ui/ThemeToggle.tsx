import { useAppDispatch, useAppSelector } from "@/app/hooks";
import { setTheme } from "./uiSlice";
import { Moon, Sun } from "lucide-react";
import { useEffect } from "react";

/**
 * КОМПОНЕНТ ПЕРЕКЛЮЧАТЕЛЯ ТЕМЫ WARHAMMER 40,000 FANDOM WIKI
 * 
 * Предоставляет пользователю возможность переключаться между темной и светлой темами:
 * - Отображает соответствующую иконку текущей темы
 * - Сохраняет выбор темы в Redux store и localStorage
 * - Применяет CSS классы к корневому элементу документа
 * - Поддерживает доступность через title атрибуты
 */
export default function ThemeToggle() {
  /**
   * ПОЛУЧЕНИЕ ТЕКУЩЕЙ ТЕМЫ ИЗ REDUX STORE
   * 
   * Использует кастомный хук useAppSelector для доступа к состоянию UI
   * theme может быть "dark" или "light"
   */
  const theme = useAppSelector(s => s.ui.theme);
  
  /**
   * ПОЛУЧЕНИЕ ФУНКЦИИ ДИСПАТЧА ДЛЯ ОТПРАВКИ ДЕЙСТВИЙ В REDUX
   */
  const d = useAppDispatch();

  /**
   * ЭФФЕКТ ПРИМЕНЕНИЯ ТЕМЫ К ДОКУМЕНТУ
   * 
   * Выполняется при каждом изменении темы:
   * 1. Удаляет оба возможных класса темы с корневого элемента
   * 2. Добавляет текущий класс темы
   * 
   * Это обеспечивает мгновенное визуальное применение темы
   * без перезагрузки страницы
   */
  useEffect(() => {
    document.documentElement.classList.remove("dark", "light");
    document.documentElement.classList.add(theme);
  }, [theme]);

  /**
   * ОБРАБОТЧИК ПЕРЕКЛЮЧЕНИЯ ТЕМЫ
   * 
   * При клике на кнопку:
   * - Определяет противоположную тему (dark ↔ light)
   * - Диспатчит действие setTheme с новой темой
   * - Новое значение автоматически сохраняется в uiSlice
   */
  const handleToggle = () => {
    d(setTheme(theme === "dark" ? "light" : "dark"));
  };

  return (
    /**
     * КНОПКА ПЕРЕКЛЮЧАТЕЛЯ ТЕМЫ
     * 
     * Стилизована в соответствии с дизайном Warhammer 40,000:
     * - Граница цвета brass (латунь) в соответствии с тематикой
     * - Hover эффект с изменением фона и текста
     * - Плавные переходы для улучшения пользовательского опыта
     * - Title атрибут для доступности и подсказки
     */
    <button
      className="p-2 rounded-lg border border-brass hover:bg-brass hover:text-black transition"
      onClick={handleToggle}
      title={theme === "dark" ? "Светлая тема" : "Тёмная тема"}
      aria-label={theme === "dark" ? "Переключить на светлую тему" : "Переключить на тёмную тему"}
    >
      {/* УСЛОВНЫЙ РЕНДЕРИНГ ИКОНКИ В ЗАВИСИМОСТИ ОТ ТЕКУЩЕЙ ТЕМЫ */}
      {theme === "dark" ? 
        <Moon className="w-5 h-5" /> :  // Иконка луны для тёмной темы
        <Sun className="w-5 h-5" />     // Иконка солнца для светлой темы
      }
    </button>
  );
}





// Комментарии объясняют:

// 1. Назначение компонента

// Управление цветовой темой всего приложения
// Визуальная индикация текущей темы через иконки
// Сохранение пользовательских предпочтений между сессиями

// 2. Интеграцию с системой состояния

// Использование Redux для централизованного управления темой
// Синхронизацию с UI слоем через useAppSelector/useAppDispatch
// Автоматическое сохранение в localStorage (реализовано в uiSlice)

// 3. Механизм применения темы

// Манипуляцию CSS классами на корневом элементе документа
// Мгновенное визуальное обновление без перезагрузки страницы
// Чистую установку темы через удаление старых классов перед добавлением новых

// 4. Пользовательский опыт

// Интуитивную иконографику (Луна = темная тема, Солнце = светлая)
// Подсказки при наведении для понятного взаимодействия
// Плавные анимации перехода между состояниями
// Доступность через aria-атрибуты

// 5. Дизайн и брендинг

// Соблюдение цветовой палитры Warhammer 40,000 (brass)
// Согласованность стилей с остальным приложением
// Компактный размер для удобного размещения в интерфейсе

// Компонент ThemeToggle обеспечивает удобное и эстетически 
// соответствующее переключение между темами в Warhammer 40,000 Fandom Wiki, 
// значительно улучшая пользовательский опыт за счет персонализации визуального оформления.




