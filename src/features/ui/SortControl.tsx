import { useAppDispatch, useAppSelector } from "@/app/hooks";
import { setSort } from "./uiSlice";

/**
 * ТИПЫ КЛЮЧЕЙ СОРТИРОВКИ ДЛЯ ГЛАВНОГО КОМПОНЕНТА УПРАВЛЕНИЯ СОРТИРОВКОЙ
 * 
 * Определяет упрощенный набор вариантов сортировки для основного интерфейса:
 * - new: сначала новые статьи (по убыванию ID или даты)
 * - old: сначала старые статьи (по возрастанию ID или даты)
 * - az: заголовок по алфавиту (A → Z)
 * - za: заголовок в обратном алфавитном порядке (Z → A)
 * - author: сортировка по имени автора (A → Z)
 */
export type SortKey = "new" | "old" | "az" | "za" | "author";

/**
 * КОНФИГУРАЦИЯ ВАРИАНТОВ СОРТИРОВКИ
 * 
 * Массив объектов с настройками для каждого варианта сортировки:
 * - value: техническое значение для обработки в коде
 * - label: понятное описание на русском языке для пользователя
 */
const options: { value: SortKey; label: string }[] = [
  { value: "new",   label: "Сначала новые" },
  { value: "old",   label: "Сначала старые" },
  { value: "az",    label: "A → Z (заголовок)" },
  { value: "za",    label: "Z → A (заголовок)" },
  { value: "author",label: "Автор A → Z" },
];

/**
 * КОМПОНЕНТ УПРАВЛЕНИЯ СОРТИРОВКОЙ WARHAMMER 40,000 FANDOM WIKI
 * 
 * Основной компонент для управления порядком отображения статей:
 * - Интегрирован с Redux store для глобального управления состоянием
 * - Предоставляет удобный выпадающий список вариантов сортировки
 * - Автоматически применяет выбранную сортировку ко всем статьям
 * - Поддерживает адаптивный дизайн для различных размеров экранов
 */
export default function SortControl() {
  /**
   * ПОЛУЧЕНИЕ ТЕКУЩЕЙ СОРТИРОВКИ ИЗ REDUX STORE
   * 
   * Использует хук useAppSelector для доступа к состоянию UI
   * Значение сортировки сохраняется между сессиями через uiSlice
   */
  const sort = useAppSelector(s => s.ui.sort);
  
  /**
   * ПОЛУЧЕНИЕ ФУНКЦИИ ДИСПАТЧА ДЛЯ ОБНОВЛЕНИЯ СОСТОЯНИЯ
   */
  const d = useAppDispatch();

  return (
    <div className="w-full sm:w-auto">
      {/* 
        СКРЫТАЯ МЕТКА ДЛЯ ДОСТУПНОСТИ (ACCESSIBILITY)
        Обеспечивает правильную работу с screen readers
        htmlFor связывает метку с элементом select по id
      */}
      <label className="sr-only" htmlFor="sort">Сортировка</label>

      {/* 
        ОБЁРТКА ДЛЯ СТИЛИЗАЦИИ ВЫПАДАЮЩЕГО СПИСКА
        - w-full sm:w-56: адаптивная ширина (100% на мобильных, фиксированная на планшетах и выше)
        - sort-wrap: SCSS класс для кастомной стилизации
      */}
      <div className="sort-wrap w-full sm:w-56">
        {/*
          ВЫПАДАЮЩИЙ СПИСОК ВАРИАНТОВ СОРТИРОВКИ
          - id="sort": для связи с меткой доступности
          - value: привязка к текущему значению из Redux store
          - onChange: обработчик изменения с диспатчем действия в Redux
          - className: применение SCSS стилей и адаптивной ширины
        */}
        <select
          id="sort"
          value={sort}
          onChange={(e) => d(setSort(e.target.value))}
          className="sort-select w-full"
        >
          {/*
            ДИНАМИЧЕСКОЕ СОЗДАНИЕ OPTION ЭЛЕМЕНТОВ
            Для каждого варианта сортировки создается option с:
            - key: уникальный идентификатор для React
            - value: техническое значение для обработки
            - label: понятное описание для пользователя
          */}
          {options.map(o => (
            <option key={o.value} value={o.value}>{o.label}</option>
          ))}
        </select>
      </div>
    </div>
  );
}



// Комментарии объясняют:

// 1. Архитектуру компонента

// Интеграцию с Redux для глобального управления состоянием сортировки
// Упрощенный набор опций по сравнению с SortSelect для основного интерфейса
// Автоматическое применение изменений через систему действий Redux

// 2. Систему типов и конфигурации

// Специализированный тип SortKey для этого компонента
// Конфигурируемые опции с разделением технических и пользовательских значений
// Четкую структуру данных для вариантов сортировки

// 3. Пользовательский опыт

// Адаптивный дизайн - полная ширина на мобильных, компактный вид на десктопах
// Понятные формулировки на русском языке
// Поддержку доступности через скрытую метку и правильную разметку

// 4. Технические особенности

// SCSS стилизацию через классы sort-wrap и sort-select
// Прямую интеграцию с uiSlice через действие setSort
// Нормализацию значений на уровне uiSlice для защиты от ошибок

// 5. Бизнес-логику сортировки

// Хронологическую организацию (новые/старые)
// Алфавитную сортировку заголовков и авторов
// Упрощенный интерфейс для конечных пользователей

// Компонент SortControl обеспечивает удобное и интуитивное 
// управление порядком отображения контента в Warhammer 40,000 Fandom Wiki, 
// интегрируясь с глобальной системой состояния приложения и предоставляя согласованный 
// пользовательский опыт across всех страниц.




